# Note on DTD Compatibility Implementation #
<br>

The implementation of the DTD compatibility features is independent from the validation implementation and it is possible to control which features and levels are to be processed from the command line, or through the <code>setFeature(String name, boolean value)</code> methods of the JAXP validation API. Furthermore, when a schema document contains errors with impact on the DTD compatibility handling, implementations of the abstract class <code>serene.SereneRecoverableException</code> extending <code>org.xml.sax.SAXParseException</code> are used, so that they can be caught separately and the features set in the <code>javax.xml.validation.ValidatorHandler</code> and <code>javax.xml.validation.Validator</code> can be adjusted. Concrete implementations are:<br>
<br>
<ul><li><code>serene.dtdcompatibility.AttributeDefaultValueException</code> for attribute default values<br>
</li><li><code>serene.dtdcompatibility.AttributeIdTypeException</code> for attributes of ID-type ID, IDREF, IDREFS<br>
</li><li><code>serene.dtdcompatibility.DocumentationElementException</code> for documentation elements</li></ul>

Even when the compatibility property does not hold for one of the features, this allows the schema to still be safely used for validation and the other compatibility features. In order to provide direct access, without the need to cast, to those classes the interface <code>serene.dtdcompatibility.DTDCompatibilityErrorHandler</code>, extending <code>org.xml.sax.ErrorHandler</code>, has been created.<br>
<br>
It is the client's responsibility to ensure that the errors are caught in an appropriate manner and the right features are set. When attempting to use an instance of <code>javax.xml.validation.ValidatorHandler</code> or <code>javax.xml.validation.Validator</code> an <code>IllegalStateException</code> is thrown if schema document contained errors that made it impossible to support a certain feature and that feature is set to true. When attempting to set to true a feature in the <code>javax.xml.validation.ValidatorHandler</code> or <code>javax.xml.validation.Validator</code> an <code>org.xml.sax.SAXNotSupportedException</code> is thrown if schema document contained errors that made it impossible to support that feature or if corresponding level 1 features were not set in the <code>javax.xml.validation.SchemaFactory</code>.<br>
<br>
For attribute default values, the specification requires that "the value of the a:defaultValue attribute matches the pattern contained in the attribute element", but it is not clear if the <i>soundness</i> relation for the ID, IDREF, IDREFS should be regarded as part of the pattern. I chose to check during the compatibility property control, provided apropriate features were set, if this relashionship holds, but only issue warnings. The reason for this is that there are many situations where the document can be correct even if the default values used in the schema would result in errors, but if error messages were to be issued, than, according to the general strategy described above, the client should have to unset the features and not continue the compatibility processing of the document for them. On the other hand it seems natural that the user gets some kind of message, especially where the ID-type is ID.